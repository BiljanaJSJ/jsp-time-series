---
title: "Notebook - Hakai Institute Juvenile Salmon Program Time Series"
output: _notebook
---

This is my lab notebook for ideas, literature review, and exploratory data analysis related to the preparation of a manuscript for reporting yearly time series data of the Hakai Institute Juvenile Salmon Program.

# Objectives:
The objectives of this manuscript are to:

* Introduce the Juvenile Salmon Program
* Describe briefly the methods related to field program 
* Present time series of data
* Point to papers that present deeper analysis of time series data

# Key Parameters Reported:

## Fish Metrics
* Salmon CPUE
* Spp. composition. Plot per week, per migration corridor
* Stock specific relative condition factor
* Lengths
* Weights
* Parasite loads

## Oceanography
* Chl a - Justin sorting out phaepigments...
* Phyto Biomass
* Nutrients - Depending on when they are analyzed 
* Zoop biomass	
* Temp CTD binning
* Salinity CTD binning

Overlap with other current analyses include
* Salish Sea Marine Survival Project: Run-timing, GSI, CPUE, Relative Condition, Lengths, Weights
* In-season reports: Sea lice, temp, chl a

New analysis (No overlap)

* Salinity, Nutrients, Zoop biomass, Phyto biomass. (Kang has these time series)

# Literature Review

  __Beamish, R. J., Pearsall, I. a, & Healey, M. C. (2003). A history of the research on the early Marine life of Pacific salmon off Canada’s Pacific coast. NPAFC Bulletin, 3(3), 1–40.__

To read:
Groot and Cooke 1987
Brett 1965
Hart 1980
Johnson and Groot 1963
Groot 1972
Foerester 1968
Hartt 1980
Dell 1986

“Levings and Kotyk (1983) carried out two trawling surveys for juvenile sal- monids (chum, pink, coho, chinook and steelhead) in Discovery Passage and nearby channels in the north- ern Strait of Georgia. This was part of a sampling program established to examine the dispersal of wild chinook fry and juvenile marked chinook from re- lease experiments at Quinsam hatchery into the Campbell River (Fig. 1) estuary.”

“Beamish, R. J., Pearsall, I. a, & Healey, M. C. (2003). A history of the research on the early marine life of Pacific salmon off Canada’s Pacific coast. NPAFC Bulletin, 3(3), 1–40.”

“Upon leaving the Fraser River estuary, most smolts proceed along the mainland coast north- ward but some are flushed west across the Strait of Georgia by the Fraser River plume and tidal currents towards the Gulf Islands. Once among the Gulf Is- lands, these smolts turn north and migrate diagonally back across the Strait to join up with the smolts that have moved directly north from the river mouth (Groot and Cooke 1987). Groot”

__Brodeur, R. D., Myers, K. W., & Helle, J. H. (2003). Research conducted by the United States on the early ocean life history of Pacific salmon. North Pacific Anadromous Fish Commission Bulletin Number 3, (3), 89–131.__

To read:
Brodeur and Pearcy (1986)
Pearcy and FIsher 1990
Straty 1974 
Looks like a good one
Farley et al. (1999, 2000a, 2001a, c)
# Analysis Notebook
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(hakaisalmon)
library(tidyverse)
library(lubridate)
```

```{r Migration timing}
cpue <-  select(survey_seines, survey_date, sampling_week, site_id, region, so_total) %>%
  filter(site_id %in% c("D07", "D09", "D22", "D27", "D10", "D08", "D34",
                        "D20", "J03", "J02", "J09", "J11")) %>%
  # I only included the above sites, because they have been consistent
  # over the last few years.
  mutate(year = year(survey_date)) %>%
  select(-site_id, -survey_date) %>% 
  replace_na(list(so_total = 0)) %>% 
  group_by(year, region, sampling_week) %>% 
  summarise_each(funs(mean, sd, cpue.se=sd(.) / sqrt(n())))
  

cpue$year <- as.factor(cpue$year)
labels <- c(DI = "Discovery Islands", JS = "Johnstone Strait")
cpue$sampling_week <- as_factor(cpue$sampling_week)
dodge <- position_dodge(width=0.5)
  
cpue_plot_error_bars <- ggplot(data = cpue, aes(x = sampling_week, y = mean,
                                     colour = year, group = year)) +
  geom_errorbar(aes(ymin = mean - cpue.se, ymax = mean + cpue.se),
  position = position_dodge(width = 0.15),
  width = 0.3) +
  facet_wrap(~ region, nrow = 2, scales = "free_y",
             labeller = labeller(region = labels)) +
  theme(strip.text.x = element_text(size=12)) +
  geom_line(size = 1.5) +
  geom_point(size = 2, position = position_dodge(width = 0.15)) +
  xlab("Date") +
  ylab("Sockeye CPUE") +
  theme(legend.justification = c(1, 0), legend.position = c(.83, .67)) +
  theme(legend.title = element_blank()) +
  theme(legend.text = element_text(colour = "black", size = 12)) +
  theme(axis.text = element_text(size = 12),
        axis.text.x = element_text(angle = 45, vjust = 0.5),
        axis.title = element_text(size = 12, face = "bold")) 


cpue_plot_error_bars
```

```{r Species composition}


# Generate SEMSP IDs for all fish caught based on catch data entered in the
# field spreadsheets
tidy_catch<- survey_seines %>% 
  select(survey_date, seine_id, so_total, pi_total, cu_total, co_total, he_total) %>% 
  mutate(year = year(survey_date)) %>% 
  drop_na(so_total) %>% # This removes instances when the net was not set
  gather(`so_total`, `pi_total`, `cu_total`, `co_total`, `he_total`, key = "species",
         value = "n") %>% 
  drop_na()

tidy_catch <- as.data.frame(tidy_catch)

tidy_catch_expanded<- tidy_catch[rep(row.names(tidy_catch), tidy_catch$n), 1:4]

tidy_catch_expanded <- tidy_catch_expanded %>% 
  group_by(year, species) %>% 
  summarize(n = n()) %>% 
  mutate(proportion = n / sum(n)) %>%
  ungroup()

ggplot(data = tidy_catch_expanded, aes(x = year, y = proportion, fill = species)) +
      geom_bar(stat="identity", position = 'stack') 
           
```




